# 📖 密码预测模型 - 测试使用说明

这份文档将指导你如何使用测试系统来验证模型的预测能力。

---

## 🎯 快速开始

### 方式一：自动测试 (推荐，用于演示)

**一键运行所有测试**：

```bash
cd ml_code
/Users/east/CursorProjects/ml_code/iot/bin/python run_auto_test.py
```

**运行结果**：
- 自动测试前10个密码
- 显示每个测试的详细结果
- 生成测试报告
- 保存到 `../test_results/` 目录

**输出文件**：
- `test_report_*.txt` - 详细的文本报告
- `test_results_*.csv` - CSV格式的结果数据

---

### 方式二：手动测试单个密码

**适合场景**：
- 测试特定密码
- 理解预测过程
- 调试问题

**步骤**：

#### 1. 查看可用的测试文件

```bash
ls -lh ../test_data/
```

你会看到15个测试文件：

```
test_password_12345_*.csv  (已自动测试)
test_password_54321_*.csv  (已自动测试)
...
test_password_56789_*.csv  (留给你测试)
test_password_00000_*.csv  (留给你测试)
test_password_99999_*.csv  (留给你测试)
test_password_50505_*.csv  (留给你测试)
test_password_84273_*.csv  (留给你测试)
```

#### 2. 运行单个测试

```bash
cd ml_code

# 语法：
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_[密码]_*.csv \
    --actual [密码]

# 示例1：测试密码 56789
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_56789_*.csv \
    --actual 56789

# 示例2：测试密码 00000
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_00000_*.csv \
    --actual 00000
```

#### 3. 理解输出

```
============================================================
密码序列预测
============================================================
加载模型: ./models/xgboost_20251030_162345.pkl
✓ 模型类型: xgboost
✓ 特征数量: 303

分析文件: ../test_data/test_password_56789_*.csv
  数据行数: 4520
  检测到 5 个按键事件
  按键 1: 预测=5, 实际=5, 置信度=100.00%
  按键 2: 预测=6, 实际=6, 置信度=100.00%
  按键 3: 预测=7, 实际=7, 置信度=98.50%
  按键 4: 预测=8, 实际=8, 置信度=100.00%
  按键 5: 预测=9, 实际=9, 置信度=100.00%

预测的密码序列: 5 6 7 8 9

============================================================
评估结果
============================================================
实际密码: 5 6 7 8 9
预测密码: 5 6 7 8 9
✓ 完全正确！

============================================================
预测完成！密码: 5 6 7 8 9
============================================================
```

---

## 📁 文件结构说明

```
iotproject/
├── ml_code/                              # 机器学习代码目录
│   ├── models/                          # 训练好的模型
│   │   └── xgboost_20251030_162345.pkl # 当前最佳模型
│   ├── 4_predict_password.py           # 单个密码预测脚本
│   ├── run_auto_test.py                # 自动测试脚本
│   └── generate_test_data.py           # 测试数据生成器
│
├── test_data/                           # 测试数据目录
│   ├── test_password_12345_*.csv       # 测试样本
│   ├── test_password_56789_*.csv       # 留给你测试
│   ├── ...
│   └── test_manifest.txt               # 测试文件清单
│
├── test_results/                        # 测试结果目录
│   ├── test_report_*.txt               # 详细测试报告
│   └── test_results_*.csv              # CSV格式结果
│
└── 测试结果展示报告.md                   # 格式化的展示报告
```

---

## 🧪 5个留给你的测试密码

### 测试 11: 高位顺序 (56789)

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_56789_*.csv \
    --actual 56789
```

**预期**: 应该全部正确（类似12345）

---

### 测试 12: 全0 (00000)

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_00000_*.csv \
    --actual 00000
```

**注意**: 可能类似11111，存在重复数字识别问题

---

### 测试 13: 全9 (99999)

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_99999_*.csv \
    --actual 99999
```

**注意**: 可能类似11111，存在重复数字识别问题

---

### 测试 14: 交替模式 (50505)

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_50505_*.csv \
    --actual 50505
```

**有趣点**: 测试交替按键的识别能力

---

### 测试 15: 随机组合 (84273)

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_84273_*.csv \
    --actual 84273
```

**预期**: 应该表现良好（类似其他随机组合）

---

## 🎓 给老师演示的建议流程

### 1. 展示自动测试 (5分钟)

```bash
cd ml_code
/Users/east/CursorProjects/ml_code/iot/bin/python run_auto_test.py
```

**说明要点**：
- "这是对10个不同密码的自动测试"
- "平均准确率达到90%"
- "8个密码完全正确预测"

---

### 2. 演示单个密码预测 (3分钟)

选择一个简单的例子：

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_12345_*.csv \
    --actual 12345
```

**说明要点**：
- "这是一个测试密码12345的例子"
- "模型逐个识别每次按键"
- "可以看到每个预测的置信度"
- "最终完全正确预测了密码"

---

### 3. 展示测试报告 (2分钟)

打开 `测试结果展示报告.md` 或 `test_results/test_report_*.txt`

**说明要点**：
- "这是详细的测试报告"
- "包含所有测试的准确率"
- "分析了错误模式"
- "提供了防御建议"

---

### 4. 互动测试 (可选，5分钟)

让老师选择一个密码，现场测试：

```bash
# 让老师从5个未测试密码中选一个
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_[老师选的]_*.csv \
    --actual [老师选的密码]
```

---

## ❓ 常见问题

### Q1: 为什么有些密码预测不准确？

**A**: 主要有两个原因：

1. **相邻数字混淆**: 如4和8在键盘上接近，传感器数据相似
2. **重复数字问题**: 连续相同数字可能被识别为单次按键

### Q2: 为什么准确率是90%而不是100%？

**A**: 这是侧信道攻击的固有限制：

- 键盘布局导致相邻数字难以区分
- 不同人按键方式有差异
- 传感器数据存在噪声
- 90%已经是很高的准确率了（远超随机猜测的10%）

### Q3: 如何生成更多测试数据？

**A**: 运行测试数据生成器：

```bash
cd ml_code
/Users/east/CursorProjects/ml_code/iot/bin/python generate_test_data.py
```

然后输入想要的密码和数量。

### Q4: 可以测试更长的密码吗？

**A**: 可以！修改 `generate_test_data.py` 中的密码列表，添加6位或更长的密码。

### Q5: 测试报告保存在哪里？

**A**: 所有测试结果保存在：

- `../test_results/test_report_*.txt` - 文本报告
- `../test_results/test_results_*.csv` - CSV数据
- `../测试结果展示报告.md` - 格式化展示报告

---

## 🔍 深入理解

### 预测原理

1. **数据收集**: 手机传感器记录按键时的加速度、陀螺仪等数据
2. **特征提取**: 从传感器数据中提取303个特征
3. **模型预测**: XGBoost模型根据特征预测按下的数字
4. **序列组合**: 将多个预测结果组合成完整密码

### 为什么这是安全威胁？

- **无需权限**: 访问传感器不需要特殊权限
- **后台运行**: 恶意App可以在后台悄悄收集数据
- **高准确率**: 90%的准确率足以破解大多数密码
- **难以检测**: 用户很难察觉传感器正在被访问

### 防御措施

1. **技术防御**:
   - 使用生物识别（指纹、Face ID）
   - 虚拟键盘随机布局
   - 限制后台传感器访问

2. **用户习惯**:
   - 定期检查应用权限
   - 卸载不必要的应用
   - 在敏感操作时注意周围环境

---

## 📊 测试统计速查表

| 测试ID | 密码 | 状态 | 准确率 | 备注 |
|--------|------|------|--------|------|
| 1 | 12345 | ✅ | 100% | 顺序数字 |
| 2 | 54321 | ✅ | 100% | 逆序数字 |
| 3 | 13579 | ✅ | 100% | 奇数序列 |
| 4 | 24680 | ✅ | 100% | 偶数序列 |
| 5 | 11111 | ⚠️ | 20% | 重复数字问题 |
| 6 | 98765 | ✅ | 100% | 大数逆序 |
| 7 | 02468 | ✅ | 100% | 从0开始 |
| 8 | 19283 | ✅ | 100% | 随机组合 |
| 9 | 74650 | ⚠️ | 80% | 4→8混淆 |
| 10 | 36912 | ✅ | 100% | 随机组合 |
| 11-15 | ... | ⭕ | 待测试 | 留给用户 |

**总体**: 平均准确率 **90%**，完全正确 **8/10**

---

## 💡 提示和技巧

### 提示 1: 批量测试

如果要测试所有5个剩余密码：

```bash
cd ml_code

for pwd in 56789 00000 99999 50505 84273; do
    echo "测试密码: $pwd"
    python 4_predict_password.py \
        --model ./models/xgboost_20251030_162345.pkl \
        --data ../test_data/test_password_${pwd}_*.csv \
        --actual $pwd
    echo "---"
done
```

### 提示 2: 保存测试输出

```bash
python 4_predict_password.py \
    --model ./models/xgboost_20251030_162345.pkl \
    --data ../test_data/test_password_56789_*.csv \
    --actual 56789 \
    > my_test_result.txt 2>&1
```

### 提示 3: 快速查看测试文件清单

```bash
cat ../test_data/test_manifest.txt
```

---

## 📞 需要帮助？

如果遇到问题：

1. **检查文件路径**: 确保在 `ml_code/` 目录下运行命令
2. **检查模型文件**: 确认 `models/xgboost_*.pkl` 存在
3. **检查测试数据**: 确认 `../test_data/` 目录中有测试文件
4. **查看错误信息**: 仔细阅读错误提示

---

**祝测试顺利！🎉**

如果模型表现良好，说明你的IoT侧信道攻击项目非常成功！
